# Diff: [Part C] CompactLockoutBar in workspace

- **Commit:** b98af89
- **Timestamp:** 2026-02-05T20:24:33 CST
- **Stats:**
```
 .../projectStats.xcodeproj/project.pbxproj         |  4 +++
 .../ViewModels/TabManagerViewModel.swift           |  5 ++-
 .../projectStats/Views/IDE/CompactLockoutBar.swift | 39 ++++++++++++++++++++++
 .../projectStats/Views/TabBar/WorkspaceView.swift  |  5 +++
 projectStats/projectStatsTests/ModelTests.swift    | 10 ++++++
 5 files changed, 60 insertions(+), 3 deletions(-)
```

## Summary
Added CompactLockoutBar view showing Claude plan usage as a thin gradient bar at the top of every project workspace. Reads from ClaudePlanUsageService singleton.

## Full Diff
```diff
diff --git a/projectStats/projectStats.xcodeproj/project.pbxproj b/projectStats/projectStats.xcodeproj/project.pbxproj
index b443569..7051f09 100644
--- a/projectStats/projectStats.xcodeproj/project.pbxproj
+++ b/projectStats/projectStats.xcodeproj/project.pbxproj
@@ -105,6 +105,7 @@
 		010000000000000000000096 /* projectStats/Views/Git/CommitDialog.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000096 /* projectStats/Views/Git/CommitDialog.swift */; };
 		010000000000000000000097 /* projectStats/Views/Git/GitControlsView.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000097 /* projectStats/Views/Git/GitControlsView.swift */; };
 		010000000000000000000098 /* projectStats/Views/IDE/ContextUsageBar.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000098 /* projectStats/Views/IDE/ContextUsageBar.swift */; };
+		010000000000000000000182 /* projectStats/Views/IDE/CompactLockoutBar.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000182 /* projectStats/Views/IDE/CompactLockoutBar.swift */; };
 		010000000000000000000099 /* projectStats/Views/IDE/DevServerTab.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000099 /* projectStats/Views/IDE/DevServerTab.swift */; };
 		010000000000000000000100 /* projectStats/Views/IDE/RunningServersPopover.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000100 /* projectStats/Views/IDE/RunningServersPopover.swift */; };
 		010000000000000000000101 /* projectStats/Views/IDE/TerminalTabBar.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000101 /* projectStats/Views/IDE/TerminalTabBar.swift */; };
@@ -288,6 +289,7 @@
 		020000000000000000000096 /* projectStats/Views/Git/CommitDialog.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Git/CommitDialog.swift; sourceTree = "<group>"; };
 		020000000000000000000097 /* projectStats/Views/Git/GitControlsView.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Git/GitControlsView.swift; sourceTree = "<group>"; };
 		020000000000000000000098 /* projectStats/Views/IDE/ContextUsageBar.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/IDE/ContextUsageBar.swift; sourceTree = "<group>"; };
+		020000000000000000000182 /* projectStats/Views/IDE/CompactLockoutBar.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/IDE/CompactLockoutBar.swift; sourceTree = "<group>"; };
 		020000000000000000000099 /* projectStats/Views/IDE/DevServerTab.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/IDE/DevServerTab.swift; sourceTree = "<group>"; };
 		020000000000000000000100 /* projectStats/Views/IDE/RunningServersPopover.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/IDE/RunningServersPopover.swift; sourceTree = "<group>"; };
 		020000000000000000000101 /* projectStats/Views/IDE/TerminalTabBar.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/IDE/TerminalTabBar.swift; sourceTree = "<group>"; };
@@ -621,6 +623,7 @@
 				020000000000000000000096 /* projectStats/Views/Git/CommitDialog.swift */,
 				020000000000000000000097 /* projectStats/Views/Git/GitControlsView.swift */,
 				020000000000000000000098 /* projectStats/Views/IDE/ContextUsageBar.swift */,
+				020000000000000000000182 /* projectStats/Views/IDE/CompactLockoutBar.swift */,
 				020000000000000000000099 /* projectStats/Views/IDE/DevServerTab.swift */,
 				020000000000000000000100 /* projectStats/Views/IDE/RunningServersPopover.swift */,
 				020000000000000000000101 /* projectStats/Views/IDE/TerminalTabBar.swift */,
@@ -877,6 +880,7 @@
 				010000000000000000000096 /* projectStats/Views/Git/CommitDialog.swift in Sources */,
 				010000000000000000000097 /* projectStats/Views/Git/GitControlsView.swift in Sources */,
 				010000000000000000000098 /* projectStats/Views/IDE/ContextUsageBar.swift in Sources */,
+				010000000000000000000182 /* projectStats/Views/IDE/CompactLockoutBar.swift in Sources */,
 				010000000000000000000099 /* projectStats/Views/IDE/DevServerTab.swift in Sources */,
 				010000000000000000000100 /* projectStats/Views/IDE/RunningServersPopover.swift in Sources */,
 				010000000000000000000101 /* projectStats/Views/IDE/TerminalTabBar.swift in Sources */,
diff --git a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
index cd09d09..1ac85e8 100644
--- a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
+++ b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
@@ -219,9 +219,8 @@ class TabManagerViewModel: ObservableObject {
 
         tabs = restoredTabs
 
-        let savedIndex = UserDefaults.standard.integer(forKey: "activeTabIndex")
-        if savedIndex >= 0, savedIndex < tabs.count {
-            activeTabID = tabs[savedIndex].id
+        if let homeTab = tabs.first(where: { $0.content == .home }) {
+            activeTabID = homeTab.id
         } else {
             activeTabID = tabs[0].id
         }
diff --git a/projectStats/projectStats/Views/IDE/CompactLockoutBar.swift b/projectStats/projectStats/Views/IDE/CompactLockoutBar.swift
new file mode 100644
index 0000000..f88747d
--- /dev/null
+++ b/projectStats/projectStats/Views/IDE/CompactLockoutBar.swift
@@ -0,0 +1,39 @@
+import SwiftUI
+
+struct CompactLockoutBar: View {
+    @ObservedObject var usageService = ClaudePlanUsageService.shared
+
+    private var fillPercentage: CGFloat {
+        CGFloat(max(usageService.fiveHourUtilization, usageService.sevenDayUtilization))
+    }
+
+    private var sessionPercent: Int {
+        Int(usageService.fiveHourUtilization * 100)
+    }
+
+    private var weeklyPercent: Int {
+        Int(usageService.sevenDayUtilization * 100)
+    }
+
+    private var lockoutGradient: LinearGradient {
+        LinearGradient(
+            colors: [.blue, .purple, .pink],
+            startPoint: .leading,
+            endPoint: .trailing
+        )
+    }
+
+    var body: some View {
+        GeometryReader { geo in
+            ZStack(alignment: .leading) {
+                RoundedRectangle(cornerRadius: 4)
+                    .fill(Color.secondary.opacity(0.15))
+                RoundedRectangle(cornerRadius: 4)
+                    .fill(lockoutGradient)
+                    .frame(width: geo.size.width * fillPercentage)
+            }
+        }
+        .frame(height: 8)
+        .help("Session: \(sessionPercent)% • Weekly: \(weeklyPercent)%")
+    }
+}
diff --git a/projectStats/projectStats/Views/TabBar/WorkspaceView.swift b/projectStats/projectStats/Views/TabBar/WorkspaceView.swift
index bc760dc..d4bb4f3 100644
--- a/projectStats/projectStats/Views/TabBar/WorkspaceView.swift
+++ b/projectStats/projectStats/Views/TabBar/WorkspaceView.swift
@@ -20,6 +20,11 @@ struct WorkspaceView: View {
     var body: some View {
         if let project = project {
             VStack(spacing: 0) {
+                // Lockout bar — shows Claude plan usage at top of every workspace
+                CompactLockoutBar()
+                    .padding(.horizontal, 8)
+                    .padding(.top, 4)
+
                 // Workspace toolbar — back button + project info + actions
                 workspaceToolbar(project: project)
 
diff --git a/projectStats/projectStatsTests/ModelTests.swift b/projectStats/projectStatsTests/ModelTests.swift
index 41fe922..7318242 100644
--- a/projectStats/projectStatsTests/ModelTests.swift
+++ b/projectStats/projectStatsTests/ModelTests.swift
@@ -302,6 +302,16 @@ final class ModelTests: XCTestCase {
         XCTAssertEqual(ordered[1].versionNumber, 1)
     }
 
+    // MARK: - CompactLockoutBar Tests
+
+    @MainActor
+    func testCompactLockoutBarPercentages() {
+        let service = ClaudePlanUsageService.shared
+        // Service defaults to 0
+        XCTAssertEqual(Int(service.fiveHourUtilization * 100), 0)
+        XCTAssertEqual(Int(service.sevenDayUtilization * 100), 0)
+    }
+
     // MARK: - Projects Tab Tooltip Tests
 
     func testProjectsTabTooltipWithProjects() {
```
