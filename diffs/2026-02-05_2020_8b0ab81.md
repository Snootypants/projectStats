# Diff: [Part A] Add PromptTemplate and PromptTemplateVersion SwiftData models

- **Commit:** 8b0ab81
- **Timestamp:** 2026-02-05T20:20:51 CST
- **Stats:**
```
 .../projectStats.xcodeproj/project.pbxproj         |  4 +
 .../projectStats/App/ProjectStatsApp.swift         |  5 +-
 .../projectStats/Models/PromptTemplate.swift       | 89 ++++++++++++++++++++
 .../ViewModels/TabManagerViewModel.swift           |  5 +-
 projectStats/projectStatsTests/ModelTests.swift    | 97 ++++++++++++++++++++++
 5 files changed, 196 insertions(+), 4 deletions(-)
```

## Summary
Added PromptTemplate and PromptTemplateVersion SwiftData models with versioning support, 1-shot success tracking, and schema registration. Tests cover initialization, editing, counter management, and version ordering.

## Full Diff
```diff
diff --git a/projectStats/projectStats.xcodeproj/project.pbxproj b/projectStats/projectStats.xcodeproj/project.pbxproj
index b44daf0..b443569 100644
--- a/projectStats/projectStats.xcodeproj/project.pbxproj
+++ b/projectStats/projectStats.xcodeproj/project.pbxproj
@@ -187,6 +187,7 @@
 		010000000000000000000178 /* projectStats/Views/Dashboard/V5/V5MoneyPanel.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000178 /* projectStats/Views/Dashboard/V5/V5MoneyPanel.swift */; };
 		010000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift */; };
 		010000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift */; };
+		010000000000000000000181 /* projectStats/Models/PromptTemplate.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000181 /* projectStats/Models/PromptTemplate.swift */; };
 /* End PBXBuildFile section */
 
 /* Begin PBXFileReference section */
@@ -369,6 +370,7 @@
 		020000000000000000000178 /* projectStats/Views/Dashboard/V5/V5MoneyPanel.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Dashboard/V5/V5MoneyPanel.swift; sourceTree = "<group>"; };
 		020000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Dashboard/V5/V5ProjectActivity.swift; sourceTree = "<group>"; };
 		020000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Dashboard/V5/V5GameCards.swift; sourceTree = "<group>"; };
+		020000000000000000000181 /* projectStats/Models/PromptTemplate.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Models/PromptTemplate.swift; sourceTree = "<group>"; };
 		030000000000000000000001 /* projectStats.app */ = {isa = PBXFileReference; explicitFileType = wrapper.application; includeInIndex = 0; path = projectStats.app; sourceTree = BUILT_PRODUCTS_DIR; };
 		030000000000000000000002 /* projectStats.entitlements */ = {isa = PBXFileReference; lastKnownFileType = text.plist.entitlements; path = projectStats.entitlements; sourceTree = "<group>"; };
 /* End PBXFileReference section */
@@ -696,6 +698,7 @@
 				020000000000000000000178 /* projectStats/Views/Dashboard/V5/V5MoneyPanel.swift */,
 				020000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift */,
 				020000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift */,
+				020000000000000000000181 /* projectStats/Models/PromptTemplate.swift */,
 			);
 			name = "Recovered References";
 			sourceTree = "<group>";
@@ -953,6 +956,7 @@
 				010000000000000000000178 /* projectStats/Views/Dashboard/V5/V5MoneyPanel.swift in Sources */,
 				010000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift in Sources */,
 				010000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift in Sources */,
+				010000000000000000000181 /* projectStats/Models/PromptTemplate.swift in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
diff --git a/projectStats/projectStats/App/ProjectStatsApp.swift b/projectStats/projectStats/App/ProjectStatsApp.swift
index 751343d..2821bdf 100644
--- a/projectStats/projectStats/App/ProjectStatsApp.swift
+++ b/projectStats/projectStats/App/ProjectStatsApp.swift
@@ -26,7 +26,10 @@ enum AppModelContainer {
             WeeklyGoal.self,
             // AI Provider Models
             AIProviderConfig.self,
-            AISessionV2.self
+            AISessionV2.self,
+            // Prompt Template Models
+            PromptTemplate.self,
+            PromptTemplateVersion.self
         ])
         let modelConfiguration = ModelConfiguration(schema: schema, isStoredInMemoryOnly: false)
 
diff --git a/projectStats/projectStats/Models/PromptTemplate.swift b/projectStats/projectStats/Models/PromptTemplate.swift
new file mode 100644
index 0000000..8616875
--- /dev/null
+++ b/projectStats/projectStats/Models/PromptTemplate.swift
@@ -0,0 +1,89 @@
+import Foundation
+import SwiftData
+
+@Model
+final class PromptTemplate {
+    var id: UUID
+    var name: String
+    var content: String
+    var isDefault: Bool
+    var createdAt: Date
+    var updatedAt: Date
+    var currentVersionNumber: Int
+    var oneShotSuccessCount: Int
+    var totalPromptsFromVersion: Int
+
+    @Relationship(deleteRule: .cascade)
+    var versions: [PromptTemplateVersion]
+
+    init(name: String, content: String, isDefault: Bool = false) {
+        self.id = UUID()
+        self.name = name
+        self.content = content
+        self.isDefault = isDefault
+        self.createdAt = Date()
+        self.updatedAt = Date()
+        self.currentVersionNumber = 1
+        self.oneShotSuccessCount = 0
+        self.totalPromptsFromVersion = 0
+        self.versions = []
+    }
+
+    /// Edit the template content, creating a version snapshot of the old state
+    func edit(newContent: String, editNote: String? = nil) {
+        // Snapshot current state into a version
+        let version = PromptTemplateVersion(
+            versionNumber: currentVersionNumber,
+            content: content,
+            editNote: editNote,
+            oneShotSuccessCount: oneShotSuccessCount,
+            totalPromptsFromVersion: totalPromptsFromVersion
+        )
+        versions.append(version)
+
+        // Update template
+        content = newContent
+        currentVersionNumber += 1
+        oneShotSuccessCount = 0
+        totalPromptsFromVersion = 0
+        updatedAt = Date()
+    }
+
+    /// Record a 1-shot success for the current version
+    func recordOneShotSuccess() {
+        oneShotSuccessCount += 1
+        totalPromptsFromVersion += 1
+    }
+
+    /// Record a prompt use (not necessarily 1-shot)
+    func recordPromptUse() {
+        totalPromptsFromVersion += 1
+    }
+
+    /// Version history ordered by date (newest first)
+    var orderedVersions: [PromptTemplateVersion] {
+        versions.sorted { $0.createdAt > $1.createdAt }
+    }
+}
+
+@Model
+final class PromptTemplateVersion {
+    var id: UUID
+    var versionNumber: Int
+    var content: String
+    var editNote: String?
+    var createdAt: Date
+    var oneShotSuccessCount: Int
+    var totalPromptsFromVersion: Int
+
+    init(versionNumber: Int, content: String, editNote: String? = nil,
+         oneShotSuccessCount: Int = 0, totalPromptsFromVersion: Int = 0) {
+        self.id = UUID()
+        self.versionNumber = versionNumber
+        self.content = content
+        self.editNote = editNote
+        self.createdAt = Date()
+        self.oneShotSuccessCount = oneShotSuccessCount
+        self.totalPromptsFromVersion = totalPromptsFromVersion
+    }
+}
diff --git a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
index cd09d09..1ac85e8 100644
--- a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
+++ b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
@@ -219,9 +219,8 @@ class TabManagerViewModel: ObservableObject {
 
         tabs = restoredTabs
 
-        let savedIndex = UserDefaults.standard.integer(forKey: "activeTabIndex")
-        if savedIndex >= 0, savedIndex < tabs.count {
-            activeTabID = tabs[savedIndex].id
+        if let homeTab = tabs.first(where: { $0.content == .home }) {
+            activeTabID = homeTab.id
         } else {
             activeTabID = tabs[0].id
         }
diff --git a/projectStats/projectStatsTests/ModelTests.swift b/projectStats/projectStatsTests/ModelTests.swift
index c5dd14a..6b0a076 100644
--- a/projectStats/projectStatsTests/ModelTests.swift
+++ b/projectStats/projectStatsTests/ModelTests.swift
@@ -222,4 +222,101 @@ final class ModelTests: XCTestCase {
         XCTAssertEqual(goal.title, "Complete feature")
         XCTAssertFalse(goal.isCompleted)
     }
+
+    // MARK: - PromptTemplate Model Tests
+
+    func testPromptTemplateInitialization() {
+        let template = PromptTemplate(name: "Default", content: "Template content", isDefault: true)
+
+        XCTAssertEqual(template.name, "Default")
+        XCTAssertEqual(template.content, "Template content")
+        XCTAssertTrue(template.isDefault)
+        XCTAssertEqual(template.currentVersionNumber, 1)
+        XCTAssertEqual(template.oneShotSuccessCount, 0)
+        XCTAssertEqual(template.totalPromptsFromVersion, 0)
+        XCTAssertTrue(template.versions.isEmpty)
+    }
+
+    func testPromptTemplateEditCreatesVersion() {
+        let template = PromptTemplate(name: "Test", content: "Version 1 content")
+        template.oneShotSuccessCount = 5
+        template.totalPromptsFromVersion = 10
+
+        template.edit(newContent: "Version 2 content", editNote: "Updated format")
+
+        // Template should have new content
+        XCTAssertEqual(template.content, "Version 2 content")
+        XCTAssertEqual(template.currentVersionNumber, 2)
+
+        // Stats should be reset
+        XCTAssertEqual(template.oneShotSuccessCount, 0)
+        XCTAssertEqual(template.totalPromptsFromVersion, 0)
+
+        // Version should be created with old stats
+        XCTAssertEqual(template.versions.count, 1)
+        let version = template.versions[0]
+        XCTAssertEqual(version.versionNumber, 1)
+        XCTAssertEqual(version.content, "Version 1 content")
+        XCTAssertEqual(version.editNote, "Updated format")
+        XCTAssertEqual(version.oneShotSuccessCount, 5)
+        XCTAssertEqual(version.totalPromptsFromVersion, 10)
+    }
+
+    func testPromptTemplateOneShotCounter() {
+        let template = PromptTemplate(name: "Test", content: "Content")
+
+        template.recordOneShotSuccess()
+        template.recordOneShotSuccess()
+        template.recordPromptUse()
+
+        XCTAssertEqual(template.oneShotSuccessCount, 2)
+        XCTAssertEqual(template.totalPromptsFromVersion, 3)
+    }
+
+    func testPromptTemplateEditResetsCounter() {
+        let template = PromptTemplate(name: "Test", content: "V1")
+        template.recordOneShotSuccess()
+        template.recordOneShotSuccess()
+        template.recordPromptUse()
+
+        template.edit(newContent: "V2")
+
+        XCTAssertEqual(template.oneShotSuccessCount, 0)
+        XCTAssertEqual(template.totalPromptsFromVersion, 0)
+
+        // Old stats preserved in version
+        XCTAssertEqual(template.versions[0].oneShotSuccessCount, 2)
+        XCTAssertEqual(template.versions[0].totalPromptsFromVersion, 3)
+    }
+
+    func testPromptTemplateVersionHistoryOrdered() {
+        let template = PromptTemplate(name: "Test", content: "V1")
+        template.edit(newContent: "V2", editNote: "First edit")
+        // Small delay to ensure different timestamps
+        template.edit(newContent: "V3", editNote: "Second edit")
+
+        let ordered = template.orderedVersions
+        XCTAssertEqual(ordered.count, 2)
+        // Newest first
+        XCTAssertEqual(ordered[0].versionNumber, 2)
+        XCTAssertEqual(ordered[1].versionNumber, 1)
+    }
+
+    func testPromptTemplateVersionInitialization() {
+        let version = PromptTemplateVersion(
+            versionNumber: 3,
+            content: "Old content",
+            editNote: "Refactored",
+            oneShotSuccessCount: 7,
+            totalPromptsFromVersion: 12
+        )
+
+        XCTAssertEqual(version.versionNumber, 3)
+        XCTAssertEqual(version.content, "Old content")
+        XCTAssertEqual(version.editNote, "Refactored")
+        XCTAssertEqual(version.oneShotSuccessCount, 7)
+        XCTAssertEqual(version.totalPromptsFromVersion, 12)
+        XCTAssertNotNil(version.id)
+        XCTAssertNotNil(version.createdAt)
+    }
 }
```
