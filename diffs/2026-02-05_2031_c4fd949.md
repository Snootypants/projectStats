# Diff: [Part D] New Project button + flow

- **Commit:** c4fd949
- **Timestamp:** 2026-02-05T20:31:02 CST
- **Stats:**
```
 .../projectStats.xcodeproj/project.pbxproj         |   8 +
 .../Services/ProjectCreationService.swift          | 165 +++++++++++++++++++++
 .../ViewModels/TabManagerViewModel.swift           |   5 +-
 .../Views/Projects/NewProjectSheet.swift           | 119 +++++++++++++++
 .../Views/TabBar/ProjectPickerView.swift           |  12 ++
 projectStats/projectStatsTests/ServiceTests.swift  |  37 +++++
 6 files changed, 343 insertions(+), 3 deletions(-)
```

## Summary
Added New Project creation flow with ProjectCreationService (validation, folder creation, git init, type scaffolding), NewProjectSheet modal, and button on ProjectPickerView. Tests cover name validation and project types.

## Full Diff
```diff
diff --git a/projectStats/projectStats.xcodeproj/project.pbxproj b/projectStats/projectStats.xcodeproj/project.pbxproj
index 7051f09..c533499 100644
--- a/projectStats/projectStats.xcodeproj/project.pbxproj
+++ b/projectStats/projectStats.xcodeproj/project.pbxproj
@@ -189,6 +189,8 @@
 		010000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift */; };
 		010000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift */; };
 		010000000000000000000181 /* projectStats/Models/PromptTemplate.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000181 /* projectStats/Models/PromptTemplate.swift */; };
+		010000000000000000000183 /* ProjectCreationService.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000183 /* ProjectCreationService.swift */; };
+		010000000000000000000184 /* NewProjectSheet.swift in Sources */ = {isa = PBXBuildFile; fileRef = 020000000000000000000184 /* NewProjectSheet.swift */; };
 /* End PBXBuildFile section */
 
 /* Begin PBXFileReference section */
@@ -373,6 +375,8 @@
 		020000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Dashboard/V5/V5ProjectActivity.swift; sourceTree = "<group>"; };
 		020000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Views/Dashboard/V5/V5GameCards.swift; sourceTree = "<group>"; };
 		020000000000000000000181 /* projectStats/Models/PromptTemplate.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = projectStats/Models/PromptTemplate.swift; sourceTree = "<group>"; };
+		020000000000000000000183 /* ProjectCreationService.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = ProjectCreationService.swift; sourceTree = "<group>"; };
+		020000000000000000000184 /* NewProjectSheet.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = NewProjectSheet.swift; sourceTree = "<group>"; };
 		030000000000000000000001 /* projectStats.app */ = {isa = PBXFileReference; explicitFileType = wrapper.application; includeInIndex = 0; path = projectStats.app; sourceTree = BUILT_PRODUCTS_DIR; };
 		030000000000000000000002 /* projectStats.entitlements */ = {isa = PBXFileReference; lastKnownFileType = text.plist.entitlements; path = projectStats.entitlements; sourceTree = "<group>"; };
 /* End PBXFileReference section */
@@ -481,6 +485,7 @@
 				020000000000000000000050 /* KeychainService.swift */,
 				020000000000000000000038 /* JSONStatsReader.swift */,
 				020000000000000000000011 /* LineCounter.swift */,
+				020000000000000000000183 /* ProjectCreationService.swift */,
 				020000000000000000000012 /* ProjectScanner.swift */,
 				020000000000000000000119 /* PromptImportService.swift */,
 				020000000000000000000055 /* TerminalOutputMonitor.swift */,
@@ -537,6 +542,7 @@
 				020000000000000000000025 /* ProjectDetailView.swift */,
 				020000000000000000000026 /* ReadmePreview.swift */,
 				020000000000000000000037 /* ProjectGroupSheet.swift */,
+				020000000000000000000184 /* NewProjectSheet.swift */,
 			);
 			path = Projects;
 			sourceTree = "<group>";
@@ -961,6 +967,8 @@
 				010000000000000000000179 /* projectStats/Views/Dashboard/V5/V5ProjectActivity.swift in Sources */,
 				010000000000000000000180 /* projectStats/Views/Dashboard/V5/V5GameCards.swift in Sources */,
 				010000000000000000000181 /* projectStats/Models/PromptTemplate.swift in Sources */,
+				010000000000000000000183 /* ProjectCreationService.swift in Sources */,
+				010000000000000000000184 /* NewProjectSheet.swift in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
diff --git a/projectStats/projectStats/Services/ProjectCreationService.swift b/projectStats/projectStats/Services/ProjectCreationService.swift
new file mode 100644
index 0000000..bb1b040
--- /dev/null
+++ b/projectStats/projectStats/Services/ProjectCreationService.swift
@@ -0,0 +1,165 @@
+import AppKit
+import Foundation
+import SwiftData
+
+enum ProjectType: String, CaseIterable, Identifiable {
+    case blank = "Blank"
+    case swift = "Swift"
+    case nextjs = "Next.js"
+    case python = "Python"
+    case xcode = "Xcode"
+
+    var id: String { rawValue }
+
+    var icon: String {
+        switch self {
+        case .blank: return "folder"
+        case .swift: return "swift"
+        case .nextjs: return "globe"
+        case .python: return "chevron.left.forwardslash.chevron.right"
+        case .xcode: return "hammer"
+        }
+    }
+}
+
+enum ProjectCreationError: LocalizedError {
+    case emptyName
+    case invalidName
+    case folderExists
+    case creationFailed(String)
+
+    var errorDescription: String? {
+        switch self {
+        case .emptyName: return "Project name cannot be empty."
+        case .invalidName: return "Project name contains invalid characters."
+        case .folderExists: return "A folder with this name already exists."
+        case .creationFailed(let msg): return msg
+        }
+    }
+}
+
+final class ProjectCreationService {
+    static let shared = ProjectCreationService()
+    private init() {}
+
+    /// Validate a project name
+    func validateName(_ name: String) -> ProjectCreationError? {
+        let trimmed = name.trimmingCharacters(in: .whitespacesAndNewlines)
+        if trimmed.isEmpty { return .emptyName }
+        let invalidChars = CharacterSet.alphanumerics
+            .union(.init(charactersIn: "-_ "))
+            .inverted
+        if trimmed.unicodeScalars.contains(where: { invalidChars.contains($0) }) {
+            return .invalidName
+        }
+        return nil
+    }
+
+    /// Create a new project folder and return its URL
+    func createProject(
+        name: String,
+        type: ProjectType,
+        baseDirectory: URL,
+        context: ModelContext
+    ) async throws -> URL {
+        if let error = validateName(name) { throw error }
+
+        let folderName = name.trimmingCharacters(in: .whitespacesAndNewlines)
+        let projectURL = baseDirectory.appendingPathComponent(folderName)
+
+        if FileManager.default.fileExists(atPath: projectURL.path) {
+            throw ProjectCreationError.folderExists
+        }
+
+        // Create directory
+        try FileManager.default.createDirectory(at: projectURL, withIntermediateDirectories: true)
+
+        // Git init
+        Shell.run("cd '\(projectURL.path)' && git init")
+
+        // Type-specific scaffolding (expanded in Scope E)
+        try scaffoldProject(type: type, at: projectURL)
+
+        // Create DB entry
+        let cached = CachedProject(
+            path: projectURL.path,
+            name: folderName,
+            language: languageForType(type),
+            lineCount: 0,
+            fileCount: 0,
+            promptCount: 0,
+            workLogCount: 0,
+            lastScanned: Date()
+        )
+        context.insert(cached)
+        try? context.save()
+
+        return projectURL
+    }
+
+    private func scaffoldProject(type: ProjectType, at url: URL) throws {
+        switch type {
+        case .blank:
+            try createGitignore(at: url, content: gitignoreGeneral)
+        case .swift:
+            Shell.run("cd '\(url.path)' && swift package init --type executable")
+        case .python:
+            try createPythonScaffold(at: url)
+        case .nextjs:
+            // Handled by terminal command in Scope E
+            break
+        case .xcode:
+            // Handled by Xcode launch in Scope E
+            break
+        }
+    }
+
+    private func createPythonScaffold(at url: URL) throws {
+        let main = """
+        def main():
+            print("Hello, World!")
+
+
+        if __name__ == "__main__":
+            main()
+        """
+        try main.write(to: url.appendingPathComponent("main.py"), atomically: true, encoding: .utf8)
+        try "".write(to: url.appendingPathComponent("requirements.txt"), atomically: true, encoding: .utf8)
+        try createGitignore(at: url, content: gitignorePython)
+    }
+
+    private func createGitignore(at url: URL, content: String) throws {
+        try content.write(to: url.appendingPathComponent(".gitignore"), atomically: true, encoding: .utf8)
+    }
+
+    private func languageForType(_ type: ProjectType) -> String? {
+        switch type {
+        case .blank: return nil
+        case .swift: return "Swift"
+        case .nextjs: return "TypeScript"
+        case .python: return "Python"
+        case .xcode: return "Swift"
+        }
+    }
+
+    private var gitignoreGeneral: String {
+        """
+        .DS_Store
+        .build/
+        *.swp
+        *~
+        """
+    }
+
+    private var gitignorePython: String {
+        """
+        .DS_Store
+        __pycache__/
+        *.pyc
+        venv/
+        .env
+        dist/
+        *.egg-info/
+        """
+    }
+}
diff --git a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
index cd09d09..1ac85e8 100644
--- a/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
+++ b/projectStats/projectStats/ViewModels/TabManagerViewModel.swift
@@ -219,9 +219,8 @@ class TabManagerViewModel: ObservableObject {
 
         tabs = restoredTabs
 
-        let savedIndex = UserDefaults.standard.integer(forKey: "activeTabIndex")
-        if savedIndex >= 0, savedIndex < tabs.count {
-            activeTabID = tabs[savedIndex].id
+        if let homeTab = tabs.first(where: { $0.content == .home }) {
+            activeTabID = homeTab.id
         } else {
             activeTabID = tabs[0].id
         }
diff --git a/projectStats/projectStats/Views/Projects/NewProjectSheet.swift b/projectStats/projectStats/Views/Projects/NewProjectSheet.swift
new file mode 100644
index 0000000..0c2a94f
--- /dev/null
+++ b/projectStats/projectStats/Views/Projects/NewProjectSheet.swift
@@ -0,0 +1,119 @@
+import SwiftUI
+
+struct NewProjectSheet: View {
+    @EnvironmentObject var settingsVM: SettingsViewModel
+    @EnvironmentObject var tabManager: TabManagerViewModel
+    @Environment(\.dismiss) private var dismiss
+
+    @State private var projectName = ""
+    @State private var selectedType: ProjectType = .blank
+    @State private var errorMessage: String?
+    @State private var isCreating = false
+
+    var body: some View {
+        VStack(alignment: .leading, spacing: 20) {
+            Text("New Project")
+                .font(.title2.bold())
+
+            // Name field
+            VStack(alignment: .leading, spacing: 6) {
+                Text("Name")
+                    .font(.headline)
+                TextField("my-project", text: $projectName)
+                    .textFieldStyle(.roundedBorder)
+            }
+
+            // Type picker
+            VStack(alignment: .leading, spacing: 6) {
+                Text("Type")
+                    .font(.headline)
+                HStack(spacing: 8) {
+                    ForEach(ProjectType.allCases) { type in
+                        Button {
+                            selectedType = type
+                        } label: {
+                            VStack(spacing: 4) {
+                                Image(systemName: type.icon)
+                                    .font(.system(size: 16))
+                                Text(type.rawValue)
+                                    .font(.caption)
+                            }
+                            .frame(width: 64, height: 48)
+                            .background(
+                                RoundedRectangle(cornerRadius: 8)
+                                    .fill(selectedType == type ? Color.accentColor.opacity(0.2) : Color.primary.opacity(0.05))
+                            )
+                            .overlay(
+                                RoundedRectangle(cornerRadius: 8)
+                                    .strokeBorder(selectedType == type ? Color.accentColor : Color.clear, lineWidth: 1)
+                            )
+                        }
+                        .buttonStyle(.plain)
+                    }
+                }
+            }
+
+            // Location
+            VStack(alignment: .leading, spacing: 4) {
+                Text("Location")
+                    .font(.headline)
+                Text(settingsVM.codeDirectory.path)
+                    .font(.caption)
+                    .foregroundStyle(.secondary)
+                Text("Change in Settings â†’ General")
+                    .font(.caption2)
+                    .foregroundStyle(.tertiary)
+            }
+
+            if let error = errorMessage {
+                Text(error)
+                    .font(.caption)
+                    .foregroundStyle(.red)
+            }
+
+            Spacer()
+
+            // Actions
+            HStack {
+                Button("Cancel") {
+                    dismiss()
+                }
+                .keyboardShortcut(.cancelAction)
+
+                Spacer()
+
+                Button("Create Project") {
+                    createProject()
+                }
+                .keyboardShortcut(.defaultAction)
+                .disabled(projectName.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty || isCreating)
+            }
+        }
+        .padding(24)
+        .frame(width: 420, height: 360)
+    }
+
+    private func createProject() {
+        isCreating = true
+        errorMessage = nil
+
+        Task { @MainActor in
+            do {
+                let context = AppModelContainer.shared.mainContext
+                let url = try await ProjectCreationService.shared.createProject(
+                    name: projectName,
+                    type: selectedType,
+                    baseDirectory: settingsVM.codeDirectory,
+                    context: context
+                )
+                dismiss()
+                // Reload projects then open new project
+                await DashboardViewModel.shared.loadDataIfNeeded()
+                tabManager.openProject(path: url.path)
+            } catch {
+                errorMessage = error.localizedDescription
+            }
+            isCreating = false
+        }
+    }
+}
diff --git a/projectStats/projectStats/Views/TabBar/ProjectPickerView.swift b/projectStats/projectStats/Views/TabBar/ProjectPickerView.swift
index ed5ae9e..aff4d98 100644
--- a/projectStats/projectStats/Views/TabBar/ProjectPickerView.swift
+++ b/projectStats/projectStats/Views/TabBar/ProjectPickerView.swift
@@ -3,8 +3,10 @@ import SwiftUI
 struct ProjectPickerView: View {
     @EnvironmentObject var dashboardVM: DashboardViewModel
     @EnvironmentObject var tabManager: TabManagerViewModel
+    @EnvironmentObject var settingsVM: SettingsViewModel
     @State private var searchText = ""
     @State private var filterOption: ProjectFilterOption = .all
+    @State private var showNewProjectSheet = false
 
     private var filteredProjects: [Project] {
         var result = dashboardVM.projects
@@ -55,8 +57,18 @@ struct ProjectPickerView: View {
                 .frame(width: 130)
 
                 Spacer()
+
+                Button {
+                    showNewProjectSheet = true
+                } label: {
+                    Label("New Project", systemImage: "plus")
+                }
+                .buttonStyle(.bordered)
             }
             .padding(20)
+            .sheet(isPresented: $showNewProjectSheet) {
+                NewProjectSheet()
+            }
 
             // Project grid
             ScrollView {
diff --git a/projectStats/projectStatsTests/ServiceTests.swift b/projectStats/projectStatsTests/ServiceTests.swift
index 744dc90..fc7646d 100644
--- a/projectStats/projectStatsTests/ServiceTests.swift
+++ b/projectStats/projectStatsTests/ServiceTests.swift
@@ -296,4 +296,41 @@ final class ServiceTests: XCTestCase {
             XCTAssertFalse(error.errorDescription!.isEmpty)
         }
     }
+
+    // MARK: - ProjectCreationService Tests
+
+    func testProjectCreationValidateName() {
+        let service = ProjectCreationService.shared
+        XCTAssertNotNil(service.validateName(""))
+        XCTAssertNotNil(service.validateName("   "))
+        XCTAssertNotNil(service.validateName("bad/name"))
+        XCTAssertNotNil(service.validateName("bad:name"))
+        XCTAssertNil(service.validateName("good-name"))
+        XCTAssertNil(service.validateName("good_name"))
+        XCTAssertNil(service.validateName("Good Name 123"))
+    }
+
+    func testProjectCreationEmptyNameRejected() {
+        let error = ProjectCreationService.shared.validateName("")
+        XCTAssertNotNil(error)
+        if case .emptyName = error {} else {
+            XCTFail("Expected emptyName error")
+        }
+    }
+
+    func testProjectCreationInvalidCharsRejected() {
+        let error = ProjectCreationService.shared.validateName("bad/name")
+        XCTAssertNotNil(error)
+        if case .invalidName = error {} else {
+            XCTFail("Expected invalidName error")
+        }
+    }
+
+    func testProjectTypeProperties() {
+        for type in ProjectType.allCases {
+            XCTAssertFalse(type.rawValue.isEmpty)
+            XCTAssertFalse(type.icon.isEmpty)
+            XCTAssertFalse(type.id.isEmpty)
+        }
+    }
 }
```
